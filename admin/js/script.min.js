var primal={reactionTime:3e3,reloadTime:1300,reactionTimeout:""};function show(e){e.style.display=""}function hide(e){e.style.display="none"}function showReaction(e){"error"===e.status&&(e.status="fail"),primal.reactionBox.setAttribute("class",e.status),primal.reactionBox.innerHTML=e.text,window.clearTimeout(primal.reactionTimeout),primal.reactionTimeout=window.setTimeout(hideReaction,primal.reactionTime),1==e.reload&&(e.newurl?location.pathname=e.newurl:window.setTimeout(function(e){location.reload()},primal.reloadTime))}function hideReaction(){primal.reactionBox.setAttribute("class","")}function serializeForm(e){var t=[];return"object"==typeof e&&"form"===e.nodeName.toLowerCase()&&Array.prototype.slice.call(e.elements).forEach(function(e){e.name&&!e.disabled&&-1===["file","reset","submit","button"].indexOf(e.type)&&("select-multiple"===e.type?Array.prototype.slice.call(e.options).forEach(function(a){a.selected&&t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(a.value))}):(-1===["checkbox","radio"].indexOf(e.type)||e.checked)&&t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value)))}),t.join("&").replace(/%20/g,"+")+"&ajax=true"}function sendForm(e){if(e.preventDefault(),"primal-edit-page-form"===e.target.id){var t="";if(null!==document.querySelector('[data-block-update="true"][data-block-key]')){var a=document.querySelectorAll('[data-block-update="true"][data-block-key]'),i=[],n="";Array.prototype.forEach.call(a,function(e,t){var a=e.getAttribute("data-block-key"),o=tinymce.get("cms-field-"+a).getContent();o=(o=o.replace(/&lt;/g,"|&lt;|")).replace(/&gt;/g,"|&gt;|"),console.log(o),i.push(a),n+='<textarea class="hidden" name="'+a+'">'+o+"</textarea>"}),t+='<input type="hidden" name="blockkeys" value="'+i.join(",")+'">'+n}if(null!==document.querySelector('[data-block-update="true"][data-siteblock-key]')){a=document.querySelectorAll('[data-block-update="true"][data-siteblock-key]'),i=[],n="";Array.prototype.forEach.call(a,function(e,t){var a=e.getAttribute("data-siteblock-key"),o=e.innerHTML;o=(o=o.replace(/data-mce-style="(.*?)"/gi,"")).replace(/data-mce-bogus="(.*?)"/gi,""),i.push(a),n+='<textarea class="hidden" name="'+a+'">'+o+"</textarea>"}),e.target.querySelector(".primal-hidden-fields").innerHTML='<input type="hidden" name="blockkeys" value="'+i.join(",")+'">'+n,t+='<input type="hidden" name="siteblockkeys" value="'+i.join(",")+'">'+n}e.target.querySelector(".primal-hidden-fields").innerHTML=t}var o=e.target,r=serializeForm(o);console.log(r);var l=new XMLHttpRequest,c=o.getAttribute("action");l.open("POST",c,!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),l.send(r),l.onload=function(){if(this.status>=200&&this.status<400)try{showReaction(JSON.parse(this.responseText))}catch(e){showReaction({status:"fail",text:'Błąd w odpowiedzi. <i class="primal-icon-rain"></i>'})}else showReaction({status:"fail",text:'Błąd w odpowiedzi. <i class="primal-icon-rain"></i>'})},l.onerror=function(){showReaction({status:"fail",text:'Błąd w przesyłania danych. <i class="primal-icon-download"></i>'})}}function sendLink(e){e.preventDefault();var t=e.target.getAttribute("href"),a=new XMLHttpRequest;a.open("POST",t,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a.send(),a.onload=function(){if(this.status>=200&&this.status<400)try{showReaction(JSON.parse(this.responseText))}catch(e){showReaction({status:"fail",text:'Błąd w odpowiedzi. <i class="primal-icon-rain"></i>'})}else showReaction({status:"fail",text:'Błąd w odpowiedzi. <i class="primal-icon-rain"></i>'})},a.onerror=function(){showReaction({status:"fail",text:'Błąd w przesyłania danych. <i class="primal-icon-download"></i>'})}}function primalBlockToUpdate(e){e.target.targetElm.setAttribute("data-block-update","true")}document.addEventListener("DOMContentLoaded",function(){if(primal.reactionBox=document.getElementById("primal-reaction"),primal.editPageForm=document.querySelector("#primal-cms-edit-page form"),tinymce.init({selector:".wysiwyg.regular",inline:!0,placeholder:"Twoja treść",plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist | link image | code",init_instance_callback:function(e){e.on("change",primalBlockToUpdate)}}),null!==document.querySelector(".primal-form")){var e=document.querySelectorAll(".primal-form");Array.prototype.forEach.call(e,function(e,t){e.addEventListener("submit",sendForm)})}if(null!==document.querySelector(".primal-link")){var t=document.querySelectorAll(".primal-link");Array.prototype.forEach.call(t,function(e,t){e.addEventListener("click",sendLink)})}document.addEventListener("keydown",function(e){if(e.ctrlKey&&83===e.keyCode){e.preventDefault();var t=document.getElementById("primal-edit-page-form"),a=document.createEvent("HTMLEvents");return a.initEvent("submit",!0,!0),t.dispatchEvent(a),!1}}),primal.reactionBox.addEventListener("click",hideReaction)});