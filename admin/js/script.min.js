var primal={reactionTime:3e3,reloadTime:1300,reactionTimeout:""};function show(e){e.style.display=""}function hide(e){e.style.display="none"}function showReaction(e){"error"===e.status&&(e.status="fail"),primal.reactionBox.setAttribute("class",e.status),primal.reactionBox.innerHTML=e.text,window.clearTimeout(primal.reactionTimeout),primal.reactionTimeout=window.setTimeout(hideReaction,primal.reactionTime),1==e.reload&&(e.newurl?location.pathname=e.newurl:window.setTimeout(function(e){location.reload()},primal.reloadTime))}function hideReaction(){primal.reactionBox.setAttribute("class","")}function serializeForm(e){var t=[];return"object"==typeof e&&"form"===e.nodeName.toLowerCase()&&Array.prototype.slice.call(e.elements).forEach(function(e){e.name&&!e.disabled&&-1===["file","reset","submit","button"].indexOf(e.type)&&("select-multiple"===e.type?Array.prototype.slice.call(e.options).forEach(function(a){a.selected&&t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(a.value))}):(-1===["checkbox","radio"].indexOf(e.type)||e.checked)&&t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value)))}),t.join("&").replace(/%20/g,"+")+"&ajax=true"}function sendForm(e){if(e.preventDefault(),"primal-edit-page-form"===e.target.id){var t="";if(null!==document.querySelector('[data-block-update="true"][data-block-key]')){var a=document.querySelectorAll('[data-block-update="true"][data-block-key]'),r=[],n="";Array.prototype.forEach.call(a,function(e,t){var a=e.getAttribute("data-block-key"),i=tinymce.get("cms-field-"+a).getContent();i=(i=i.replace(/&lt;/g,"|&lt;|")).replace(/&gt;/g,"|&gt;|"),r.push(a),n+='<textarea class="hidden" name="'+a+'">'+i+"</textarea>"}),t+='<input type="hidden" name="blockkeys" value="'+r.join(",")+'">'+n}if(null!==document.querySelector('[data-block-update="true"][data-siteblock-key]')){a=document.querySelectorAll('[data-block-update="true"][data-siteblock-key]'),r=[],n="";Array.prototype.forEach.call(a,function(e,t){var a=e.getAttribute("data-siteblock-key"),i=e.innerHTML;i=(i=i.replace(/data-mce-style="(.*?)"/gi,"")).replace(/data-mce-bogus="(.*?)"/gi,""),r.push(a),n+='<textarea class="hidden" name="'+a+'">'+i+"</textarea>"}),e.target.querySelector(".primal-hidden-fields").innerHTML='<input type="hidden" name="blockkeys" value="'+r.join(",")+'">'+n,t+='<input type="hidden" name="siteblockkeys" value="'+r.join(",")+'">'+n}e.target.querySelector(".primal-hidden-fields").innerHTML=t}else if("primal-edit-portal-form"===e.target.id){t="";if(console.log("test"),null!==document.querySelector(".primal-menu-input ul")){var i=document.querySelectorAll(".primal-menu-input ul"),l={};n="";Array.prototype.forEach.call(i,function(e,t){if(null!==e.querySelector("li")){var a=[],r=e.querySelectorAll("li");Array.prototype.forEach.call(r,function(e,t){var r=e.getAttribute("data-type"),n="true"==e.getAttribute("data-rel"),i="true"==e.getAttribute("data-target");console.log(r+" "+n+" "+i);var l={};switch(n&&(l.rel="nofollow"),i&&(l.target="_blank"),r){case"cms":var o=e.getAttribute("data-key");l.type="cms",l.key=o,a.push(l);break;case"url":var c=e.getAttribute("data-name"),u=e.getAttribute("data-url");l.type="url",l.name=c,l.url=u,a.push(l)}});var n=e.getAttribute("data-name");l[n]=a}});var o=JSON.stringify(l).replace(/"/g,"&qout;");e.target.querySelector(".primal-hidden-fields").innerHTML='<input type="hidden" name="menukeys" value="'+o+'">'}}var c=e.target,u=serializeForm(c);console.log(u);var d=new XMLHttpRequest,s=c.getAttribute("action");d.open("POST",s,!0),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),d.send(u),d.onload=function(){if(this.status>=200&&this.status<400)try{showReaction(JSON.parse(this.responseText))}catch(e){showReaction({status:"fail",text:'Błąd w odpowiedzi. <i class="primal-icon-rain"></i>'})}else showReaction({status:"fail",text:'Błąd w odpowiedzi. <i class="primal-icon-rain"></i>'})},d.onerror=function(){showReaction({status:"fail",text:'Błąd w przesyłania danych. <i class="primal-icon-download"></i>'})}}function sendLink(e){e.preventDefault();var t=e.target.getAttribute("href"),a=new XMLHttpRequest;a.open("POST",t,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a.send(),a.onload=function(){if(this.status>=200&&this.status<400)try{showReaction(JSON.parse(this.responseText))}catch(e){showReaction({status:"fail",text:'Błąd w odpowiedzi. <i class="primal-icon-rain"></i>'})}else showReaction({status:"fail",text:'Błąd w odpowiedzi. <i class="primal-icon-rain"></i>'})},a.onerror=function(){showReaction({status:"fail",text:'Błąd w przesyłania danych. <i class="primal-icon-download"></i>'})}}function primalBlockToUpdate(e){e.target.targetElm.setAttribute("data-block-update","true")}function primalCheckThis(e){var t=e.value;""===t?e.setAttribute("class",""):""!==e.getAttribute("data-check-length")&&t.length<e.getAttribute("data-check-length")?(e.setAttribute("class","not-empty error"),console.log("potrzebujesz jeszcze "+(e.getAttribute("data-check-length")-t.length)+" znaków")):"true"!==e.getAttribute("data-val-email")||/^(([^<>()\[\]!\.,;:\s@"]+(\.[^<>()\[\]\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)?""!==t&&e.setAttribute("class","not-empty valid"):(e.setAttribute("class","not-empty error"),e.value=t.toLowerCase())}function appendMenuItem(e){if("cms"==e)var t=document.getElementById("itemcmspage").options[document.getElementById("itemcmspage").selectedIndex].text,a=document.getElementById("itemcmspage").value,r=document.getElementById("itemmenucms").value,n="d-title primal-icon-book",i="Podstrona CMS";else if("url"==e){t=document.getElementById("itemname").value;var l=document.getElementById("itemurl").value;r=document.getElementById("itemmenuurl").value,n="d-title primal-icon-browser",i="Strona WWW"}if(""==t||""==l)showReaction({status:"fail",text:'Nazaw i adres są wymagane. <i class="primal-icon-write"></i>'});else{var o=document.querySelector('.primal-menu-input[data-menu="'+r+'"] ul');console.log(o);var c=document.createElement("li");c.setAttribute("draggable",!0),c.setAttribute("ondragenter","dragenter(event)"),c.setAttribute("ondragstart","dragstart(event)"),c.setAttribute("data-target","false"),c.setAttribute("data-rel","false"),c.setAttribute("data-type",e),a&&c.setAttribute("data-key",a),l&&c.setAttribute("data-url",l),c.setAttribute("data-name",t.replace('"',"&quot;"));var u=document.createElement("i");u.setAttribute("class",n),u.setAttribute("data-title",i),c.appendChild(u);var d=document.createTextNode(" "+t);c.appendChild(d);var s=document.createElement("span");s.setAttribute("class","cms-menu-admin");var m=document.createElement("i");m.setAttribute("class","primal-icon-calendar d-title"),m.setAttribute("data-title","Indeksuj w wyszukiwarkach"),s.appendChild(m);var p=document.createTextNode(" ");s.appendChild(p);var f=document.createElement("i");f.setAttribute("class","primal-icon-windows d-title"),f.setAttribute("data-title","Otwieraj w nowym oknie"),s.appendChild(f);var y=document.createTextNode(" ");s.appendChild(y);var g=document.createElement("i");g.setAttribute("class","primal-icon-trash d-title"),g.setAttribute("data-title","Usuń z menu"),s.appendChild(g),c.appendChild(s),o.appendChild(c),showReaction({status:"success",text:'Dodano adres "'+t+'" <i class="primal-icon-plus"></i>'}),"cms"==e?document.getElementById("addcmspage").checked=!1:"url"==e&&(document.getElementById("itemname").value="",document.getElementById("itemurl").value="",document.getElementById("addlink").checked=!1)}}function isBefore(e,t){if(e.parentNode==t.parentNode)for(var a=e;a;a=a.previousSibling)if(a===t)return!0;return!1}function dragenter(e){isBefore(primal.soruce,e.target)?e.target.parentNode.insertBefore(primal.soruce,e.target):e.target.parentNode.insertBefore(primal.soruce,e.target.nextSibling)}function dragstart(e){primal.soruce=e.target,e.dataTransfer.setData("text/plain",""),e.dataTransfer.effectAllowed="move"}document.addEventListener("DOMContentLoaded",function(){if(primal.reactionBox=document.getElementById("primal-reaction"),primal.editPageForm=document.querySelector("#primal-cms-edit-page form"),tinymce.init({selector:".wysiwyg.regular",inline:!0,placeholder:"Twoja treść",plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist | link image | code",init_instance_callback:function(e){e.on("change",primalBlockToUpdate)}}),null!==document.querySelector(".more-when-checked input")){var e=document.querySelectorAll(".more-when-checked input");Array.prototype.forEach.call(e,function(e,t){e.addEventListener("keypress",function(e){"Enter"!=e.key&&13!=e.keyCode||(e.preventDefault(),e.stopPropagation())})})}if(null!==document.querySelector(".primal-form")){var t=document.querySelectorAll(".primal-form");Array.prototype.forEach.call(t,function(e,t){e.addEventListener("submit",sendForm)})}if(null!==document.querySelector(".primal-ajax-link")){var a=document.querySelectorAll(".primal-ajax-link");Array.prototype.forEach.call(a,function(e,t){e.addEventListener("click",sendLink)})}if(document.getElementById("primal-addlink").addEventListener("click",function(e){appendMenuItem("url")}),document.getElementById("primal-addcmslink").addEventListener("click",function(e){appendMenuItem("cms")}),null!==document.querySelector(".cms-input ul")){var r=document.querySelectorAll(".cms-input ul");Array.prototype.forEach.call(r,function(e,t){e.addEventListener("click",function(e){var t=e.target.parentNode.parentNode;switch(e.target.className){case"primal-icon-calendar d-title":"true"==t.getAttribute("data-rel")?t.setAttribute("data-rel","false"):t.setAttribute("data-rel","true");break;case"primal-icon-windows d-title":"true"==t.getAttribute("data-target")?t.setAttribute("data-target","false"):t.setAttribute("data-target","true");break;case"primal-icon-trash d-title":confirm("Na pewno chcesz usunąć ten element?")&&t.parentNode.removeChild(t)}})})}if(null!==document.querySelector("#primal-admin-panel textarea")){var n=document.querySelectorAll("#primal-admin-panel textarea");Array.prototype.forEach.call(n,function(e,t){e.addEventListener("keyup",function(t){e.parentNode.setAttribute("data-characters",e.value.length+" z.")})})}if(null!==document.querySelector(".primal-tab-label")){var i=document.querySelectorAll(".primal-tab-label");Array.prototype.forEach.call(i,function(e,t){e.addEventListener("click",function(e){e.preventDefault();var t=e.target.getAttribute("for");document.getElementById(t).checked=!document.getElementById(t).checked})})}"input blur".split(" ").forEach(function(e){document.getElementById("primal-admin-panel").addEventListener(e,function(e){"true"==e.target.getAttribute("data-check")&&primalCheckThis(e.target.length)},!0)}),document.addEventListener("keydown",function(e){if(e.ctrlKey&&!e.altKey&&83===e.keyCode){e.preventDefault();var t=document.getElementById("primal-edit-page-form"),a=document.createEvent("HTMLEvents");return a.initEvent("submit",!0,!0),t.dispatchEvent(a),!1}}),primal.reactionBox.addEventListener("click",hideReaction)});