var primal={reactionTime:1e4,reactionTimeout:""};function show(e){e.style.display=""}function hide(e){e.style.display="none"}function showReaction(e){"error"===e.status&&(e.status="fail"),primal.reactionBox.setAttribute("class",e.status),primal.reactionBox.innerHTML=e.text,window.clearTimeout(primal.reactionTimeout),primal.reactionTimeout=window.setTimeout(hideReaction,primal.reactionTime)}function hideReaction(){primal.reactionBox.setAttribute("class","")}function serializeForm(e){var t=[];return"object"==typeof e&&"form"===e.nodeName.toLowerCase()&&Array.prototype.slice.call(e.elements).forEach(function(e){e.name&&!e.disabled&&-1===["file","reset","submit","button"].indexOf(e.type)&&("select-multiple"===e.type?Array.prototype.slice.call(e.options).forEach(function(a){a.selected&&t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(a.value))}):(-1===["checkbox","radio"].indexOf(e.type)||e.checked)&&t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value)))}),t.join("&").replace(/%20/g,"+")+"&ajax=true"}function sendForm(e){if(e.preventDefault(),"primal-edit-page-form"===e.target.id){var t="";if(null!==document.querySelector('[data-block-update="true"][data-block-key]')){var a=document.querySelectorAll('[data-block-update="true"][data-block-key]'),i=[],o="";Array.prototype.forEach.call(a,function(e,t){var a=e.getAttribute("data-block-key"),n=e.innerHTML;n=n.replace(/data-mce-style="(.*?)"/gi,""),i.push(a),o+='<textarea class="hidden" name="'+a+'">'+n+"</textarea>"}),t+='<input type="hidden" name="blockkeys" value="'+i.join(",")+'">'+o}if(null!==document.querySelector('[data-block-update="true"][data-siteblock-key]')){a=document.querySelectorAll('[data-block-update="true"][data-siteblock-key]'),i=[],o="";Array.prototype.forEach.call(a,function(e,t){var a=e.getAttribute("data-siteblock-key"),n=e.innerHTML;n=(n=n.replace(/data-mce-style="(.*?)"/gi,"")).replace(/data-mce-bogus="(.*?)"/gi,""),i.push(a),o+='<textarea class="hidden" name="'+a+'">'+n+"</textarea>"}),e.target.querySelector(".primal-hidden-fields").innerHTML='<input type="hidden" name="blockkeys" value="'+i.join(",")+'">'+o,t+='<input type="hidden" name="siteblockkeys" value="'+i.join(",")+'">'+o}e.target.querySelector(".primal-hidden-fields").innerHTML=t}var n=e.target,r=serializeForm(n),l=new XMLHttpRequest,c=n.getAttribute("action");l.open("POST",c,!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),l.send(r),l.onload=function(){if(this.status>=200&&this.status<400)try{showReaction(JSON.parse(this.responseText))}catch(e){showReaction({status:"fail",text:'Błąd w odpowiedzi. <i class="primal-icon-rain"></i>'})}else showReaction({status:"fail",text:'Błąd w odpowiedzi. <i class="primal-icon-rain"></i>'})},l.onerror=function(){showReaction({status:"fail",text:'Błąd w przesyłania danych. <i class="primal-icon-download"></i>'})}}function primalBlockToUpdate(e){e.target.targetElm.setAttribute("data-block-update","true")}document.addEventListener("DOMContentLoaded",function(){if(primal.reactionBox=document.getElementById("primal-reaction"),primal.editPageForm=document.querySelector("#primal-cms-edit-page form"),tinymce.init({selector:".wysiwyg.regular",inline:!0,placeholder:"Twoja treść",plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist | link image | code",init_instance_callback:function(e){e.on("change",primalBlockToUpdate)}}),null!==document.querySelector(".primal-form")){var e=document.querySelectorAll(".primal-form");Array.prototype.forEach.call(e,function(e,t){e.addEventListener("submit",sendForm)})}primal.reactionBox.addEventListener("click",hideReaction)});